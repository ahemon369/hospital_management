{% extends 'base.html' %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Add{% endif %} Account - HMS{% endblock %}
{% block page_title %}{% if form.instance.pk %}Edit Account{% else %}Add New Account{% endif %}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Back Button -->
            <div class="mb-3">
                <a href="{% url 'financial:account_list' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Accounts
                </a>
            </div>

            <!-- Form Card -->
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-university me-2"></i>
                        {% if form.instance.pk %}Edit Account Information{% else %}New Account Registration{% endif %}
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}

                        <!-- Account Information Section -->
                        <div class="mb-4">
                            <h6 class="border-bottom pb-2 mb-3">
                                <i class="fas fa-info-circle text-primary me-2"></i>Account Information
                            </h6>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_account_name" class="form-label">Account Name *</label>
                                    <input type="text" name="account_name" class="form-control" id="id_account_name" 
                                           value="{{ form.account_name.value|default:'' }}" required
                                           placeholder="e.g., Main Checking Account">
                                    {% if form.account_name.errors %}
                                        <div class="text-danger small mt-1">{{ form.account_name.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_account_number" class="form-label">Account Number *</label>
                                    <input type="text" name="account_number" class="form-control" id="id_account_number" 
                                           value="{{ form.account_number.value|default:'' }}" required
                                           placeholder="e.g., 1234567890">
                                    {% if form.account_number.errors %}
                                        <div class="text-danger small mt-1">{{ form.account_number.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_account_type" class="form-label">Account Type *</label>
                                    <select name="account_type" class="form-select" id="id_account_type" required>
                                        <option value="">Select Account Type</option>
                                        <option value="checking" {% if form.account_type.value == 'checking' %}selected{% endif %}>Checking Account</option>
                                        <option value="savings" {% if form.account_type.value == 'savings' %}selected{% endif %}>Savings Account</option>
                                        <option value="credit" {% if form.account_type.value == 'credit' %}selected{% endif %}>Credit Account</option>
                                        <option value="cash" {% if form.account_type.value == 'cash' %}selected{% endif %}>Cash Account</option>
                                        <option value="investment" {% if form.account_type.value == 'investment' %}selected{% endif %}>Investment Account</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_currency" class="form-label">Currency</label>
                                    <select name="currency" class="form-select" id="id_currency">
                                        <option value="BDT" {% if form.currency.value == 'BDT' or not form.currency.value %}selected{% endif %}>BDT (৳)</option>
                                        <option value="USD" {% if form.currency.value == 'USD' %}selected{% endif %}>USD ($)</option>
                                        <option value="EUR" {% if form.currency.value == 'EUR' %}selected{% endif %}>EUR (€)</option>
                                        <option value="GBP" {% if form.currency.value == 'GBP' %}selected{% endif %}>GBP (£)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_balance" class="form-label">Initial Balance *</label>
                                    <div class="input-group">
                                        <span class="input-group-text">৳</span>
                                        <input type="number" name="balance" class="form-control" id="id_balance" 
                                               value="{{ form.balance.value|default:'0.00' }}" step="0.01" min="0" required>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_status" class="form-label">Status</label>
                                    <select name="status" class="form-select" id="id_status">
                                        <option value="active" {% if form.status.value == 'active' or not form.status.value %}selected{% endif %}>Active</option>
                                        <option value="inactive" {% if form.status.value == 'inactive' %}selected{% endif %}>Inactive</option>
                                        <option value="closed" {% if form.status.value == 'closed' %}selected{% endif %}>Closed</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Bank Information Section -->
                        <div class="mb-4">
                            <h6 class="border-bottom pb-2 mb-3">
                                <i class="fas fa-building text-success me-2"></i>Bank Information
                            </h6>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_bank_name" class="form-label">Bank Name</label>
                                    <input type="text" name="bank_name" class="form-control" id="id_bank_name" 
                                           value="{{ form.bank_name.value|default:'' }}"
                                           placeholder="e.g., City Bank">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_branch_name" class="form-label">Branch Name</label>
                                    <input type="text" name="branch_name" class="form-control" id="id_branch_name" 
                                           value="{{ form.branch_name.value|default:'' }}"
                                           placeholder="e.g., Gulshan Branch">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_swift_code" class="form-label">SWIFT/BIC Code</label>
                                    <input type="text" name="swift_code" class="form-control" id="id_swift_code" 
                                           value="{{ form.swift_code.value|default:'' }}"
                                           placeholder="e.g., CITYBDDHXXX">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_routing_number" class="form-label">Routing Number</label>
                                    <input type="text" name="routing_number" class="form-control" id="id_routing_number" 
                                           value="{{ form.routing_number.value|default:'' }}"
                                           placeholder="e.g., 123456789">
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information Section -->
                        <div class="mb-4">
                            <h6 class="border-bottom pb-2 mb-3">
                                <i class="fas fa-file-alt text-info me-2"></i>Additional Information
                            </h6>
                            <div class="mb-3">
                                <label for="id_description" class="form-label">Description</label>
                                <textarea name="description" class="form-control" id="id_description" rows="3" 
                                          placeholder="Add any additional notes about this account...">{{ form.description.value|default:'' }}</textarea>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_opening_date" class="form-label">Opening Date</label>
                                    <input type="date" name="opening_date" class="form-control" id="id_opening_date" 
                                           value="{{ form.opening_date.value|date:'Y-m-d'|default:'' }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" name="is_default" id="id_is_default" 
                                               {% if form.is_default.value %}checked{% endif %}>
                                        <label class="form-check-label" for="id_is_default">
                                            Set as Default Account
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Alert Messages -->
                        {% if form.errors %}
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Please correct the following errors:</strong>
                            <ul class="mb-0 mt-2">
                                {% for field, errors in form.errors.items %}
                                    {% for error in errors %}
                                        <li>{{ field }}: {{ error }}</li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <!-- Form Actions -->
                        <div class="d-flex gap-2 justify-content-end">
                            <a href="{% url 'financial:account_list' %}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>
                                {% if form.instance.pk %}Update Account{% else %}Create Account{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Info Card -->
            <div class="card shadow-sm mt-3">
                <div class="card-body">
                    <h6 class="mb-2"><i class="fas fa-info-circle text-info me-2"></i>Important Information</h6>
                    <ul class="small text-muted mb-0">
                        <li>Account number must be unique and cannot be changed later</li>
                        <li>Initial balance will be recorded as an opening balance transaction</li>
                        <li>Default account will be pre-selected in transaction forms</li>
                        <li>Inactive or closed accounts cannot be used for transactions</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}